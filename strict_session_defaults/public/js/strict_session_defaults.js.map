{"version":3,"file":"strict_session_defaults.js","sources":["../../../../apps/strict_session_defaults/strict_session_defaults/public/js/strict_session_defaults.bundle.js"],"sourcesContent":["/*\n*  Frappe Strict Session Defaults Â© 2022\n*  Author:  Ameen Ahmed\n*  Company: Level Up Marketing & Software Development Services\n*  Licence: Please refer to license.txt\n*/\n\ndocument.addEventListener('DOMContentLoaded', function() {\n    function log(msg, data) {\n        msg = 'Strict Session Defaults: ' + msg;\n        if (data) console.log(msg, data);\n        else console.log(msg);\n    }\n    \n    frappe.provide('frappe.router');\n    \n    let route = frappe.router.current_route;\n    log('Current route', route);\n    if (!Array.isArray(route) || !route.length\n    || route[0].toLowerCase() === 'login'\n    || (route[1] && route[1].toLowerCase() === 'login')) {\n        log('Stopping code in login page');\n        return;\n    }\n    \n    frappe.provide('frappe.strict_session_defaults');\n    frappe.provide('frappe.ui.toolbar');\n    \n    frappe.strict_session_defaults.init = function() {\n        frappe.call({\n            method: 'strict_session_defaults.override.get_status',\n        }).then(function(data) {\n            if (data && $.isPlainObject(data)) data = data.message || data;\n            if (!$.isPlainObject(data)) {\n                frappe.throw(__('The data received from Strict Session Defaults is invalid.'));\n                return;\n            }\n            log('Status data received', data);\n            if (!data.show) return;\n            frappe.strict_session_defaults._reqd_fields = data.reqd_fields;\n            frappe.strict_session_defaults.show();\n        });\n    };\n    \n    frappe.strict_session_defaults.show = function() {\n        if (frappe.strict_session_defaults._is_shown) return;\n        if (!frappe.ui.toolbar.setup_session_defaults) {\n            window.setTimeout(function() {\n                frappe.strict_session_defaults.show();\n            }, 200);\n            return;\n        }\n        frappe.strict_session_defaults._is_shown = true;\n        frappe.call({\n            method: 'frappe.core.doctype.session_default_settings.session_default_settings.get_session_default_values',\n            callback: function(data) {\n                let fields = JSON.parse(data.message);\n                log('Creating session dialog', fields);\n                var d = new frappe.ui.Dialog({\n                    fields: fields,\n                    title: __('Session Defaults'),\n                    'static': true\n                });\n                d.set_primary_action(__('Save'), function() {\n                    var values = d.get_values();\n                    log('Received session values', values);\n                    if (!values) {\n                        d.hide();\n                        frappe.throw(_('An error occurred while setting Session Defaults'));\n                        return;\n                    }\n                    \n                    let reqd_fields = frappe.strict_session_defaults._reqd_fields || [],\n                    count = 0;\n                    log('Filtering session values', reqd_fields);\n                    fields.forEach(function(d) {\n                        let fd = d.fieldname;\n                        if (\n                            (!reqd_fields.length || reqd_fields.indexOf(fd) >= 0)\n                            && !!values[fd]\n                        ) {\n                            count++;\n                        }\n                        else if (!values[fd]) values[fd] = \"\";\n                    });\n                    \n                    if (reqd_fields.length && count !== reqd_fields.length) {\n                        frappe.show_alert({\n                            'message': __('Please fill at least all the required fields.'),\n                            'indicator': 'orange'\n                        });\n                        return;\n                    } else if (!count) {\n                        frappe.show_alert({\n                            'message': __('Please fill at least one field.'),\n                            'indicator': 'orange'\n                        });\n                        return;\n                    }\n                    \n                    log('Saving session values', values);\n                    frappe.call({\n                        method: 'frappe.core.doctype.session_default_settings.session_default_settings.set_session_default_values',\n                        args: {default_values: values},\n                        callback: function(data) {\n                            d.hide();\n                            if (data.message == \"success\") {\n                                frappe.show_alert({\n                                    'message': __('Session Defaults Saved'),\n                                    'indicator': 'green'\n                                });\n                                frappe.call({\n                                    method: 'strict_session_defaults.override.update_status',\n                                });\n                                frappe.ui.toolbar.clear_cache();\n                            } else {\n                                frappe.throw(__('An error occurred while setting Session Defaults'));\n                            }\n                        }\n                    });\n                });\n                d.header.find('.modal-actions').remove();\n                d.show();\n            }\n        });\n    };\n    frappe.strict_session_defaults.init();\n});"],"names":["let"],"mappings":"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"}